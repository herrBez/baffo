input {
  beats {
    port => 9200
    id => "beats-1"
    add_field => {
      "[log][source]" => "myhost-${HOSTNAME:pippo}"
    }
  }
  file {
    ecs_compatibility => "disabled"
    path => "foo"
  }
}
filter {
  if [@metadata][ip_address] == "127.0.0.1" or [host] == "zizzo" and [foo] == "${HOSTNAME}" {
    # This should be a warning given that host have been renamed
    grok {
      test => 2
      id => "grok-2"
    }
  } else if [@metadata][foo] == "X.X.X.X" {
    grok {
        match => {
          "message" => [
            "foo",
            "bar",
            "%{NOTSPACE:[problem]} %{NOTSPACE}"
          ]
        } 
    }
  }
}

output {
    if [host] == "127.0.0.1" {
        elasticsearch {
            host => "127.0.0.1:9200"
            id => "elasticsearch-4"
            index => "%{[@metadata][index]}"
            pipeline => "%{[@metadata][pipeline]}"
        }
    } else {
        kafka {
            
        }
    }
}
